<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buttons from Objects</title>
</head>

<body>

        <!-- employee name -->
        <label for="dropdown_select_input" class="lbl_sm">اسم الموظف</label>
        <!-- dropdown -->
        <div class="dropdown_container" id="dropdown_container">
          <div class="dropdown_select" id="dropdown_select">
            <input type="search" id="dropdown_select_input" placeholder="اختر من القائمة"
              class="dropdown_select_input hover" readonly autocomplete="off">
            <i class="fa-solid fa-caret-down left_icon"></i>
            <input type="hidden" id="id_hidden_input" readonly>
          </div>
          <div class="dropdown_menue hover scroll" id="dropdown_menue" style="display: none;">
            <div class="dropdown_search">
              <input type="search" class="hover" id="dropdown_search_input" placeholder="ابحث هنا..."
                oninput="performSearch()" autocomplete="off">
            </div>
            <div class="dropdown_menue-items" id="dropdownItems">
              <!-- قائمة الخيارات تظهر هنا -->
            </div>
          </div>
        </div>



    <script>

async function createDropdown(fetchUrl, tableName, columnProperties, searchColumns) {
  let data = [];
  let array1 = [];
  let slice_Array1 = [];

  async function getData() {
    const response = await fetch(fetchUrl);
    data = await response.json();
    array1 = data.slice();
  };

  async function showFirst50Rows() {
    await getData();
    slice_Array1 = array1.slice(0, 50);
    fillTable();
  }

  async function fillTable() {
    let tableHTML = `<table id="${tableName}" class="review_table">
                      <thead><tr>`;

    columnProperties.forEach(col => {
      tableHTML += `<th style="${col.style}">${col.header}</th>`;
    });

    tableHTML += `</tr></thead><tbody>`;

    slice_Array1.forEach(row => {
      tableHTML += `<tr onclick="selectedRow(this)">`;
      columnProperties.forEach(col => {
        tableHTML += `<td style="${col.style}">${row[col.key]}</td>`;
      });
      tableHTML += `</tr>`;
    });

    tableHTML += `</tbody><tfoot>
                    <tr id="table_footer_buttons_row">
                      <td colspan="${columnProperties.length}">
                        <div class='flex_H'>
                          <button class="table_footer_btn" onclick="showAllRows()">All</button>
                          <button class="table_footer_btn" onclick="showFirst50Rows()">50</button>
                        </div>
                      </td>
                    </tr>
                  </tfoot></table>`;

    document.querySelector('#dropdownItems').innerHTML = tableHTML;

    if (array1.length > 0 && array1.length <= 50) {
      document.querySelector('#table_footer_buttons_row').style.display = "none";
    } else if (array1.length < 1) {
      document.querySelector('#table_footer_buttons_row').innerHTML = `<td colspan='${columnProperties.length}' class="td_no_result">لا نتائج</td>`;
    }
  };

  async function performSearch() {
    const searchValue = document.querySelector('#dropdown_search_input').value.trim().toLowerCase();

    array1 = data.filter(row => {
      return searchColumns.some(col => {
        return row[col] && row[col].toString().toLowerCase().includes(searchValue);
      });
    });

    slice_Array1 = array1.slice(0, 50);
    fillTable();
  }

  async function showAllRows() {
    slice_Array1 = array1.slice();
    await fillTable();
  }

  function selectedRow(row) {
    document.querySelector('#id_hidden_input').value = row.cells[0].textContent;
    document.querySelector('#dropdown_select_input').value = row.cells[1].textContent;
    hideDropdown();
  };

  function toggleDropdown() {
    if (dropdown_menue.style.display === "none") {
      measureDistanceToBottom();
      showDropdown();
    } else {
      measureDistanceToBottom();
      hideDropdown();
    }
  }

  async function showDropdown() {
    await showFirst50Rows();
    dropdown_menue.style.display = "block";
  }

  function hideDropdown() {
    dropdown_menue.style.display = "none";
    document.querySelector('#dropdown_search_input').value = "";
  }

  dropdown_select.addEventListener("click", toggleDropdown);

  document.addEventListener("click", (event) => {
    if (!document.querySelector('#dropdown_select').contains(event.target) &&
      !document.querySelector('#dropdown_menue').contains(event.target) &&
      !event.target.closest(`#${tableName}`)) {
      hideDropdown();
    }
  });

  document.addEventListener("keydown", (event) => {
    if (event.key === "Escape") {
      hideDropdown();
    }
  });

  function measureDistanceToBottom() {
    const dropdown_container = document.querySelector('#dropdown_container');
    const rect = dropdown_container.getBoundingClientRect();
    const windowHeight = window.innerHeight;
    const distanceToBottom = windowHeight - rect.bottom;
    const fontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);
    const distanceToBottomRem = distanceToBottom / fontSize;

    if (distanceToBottomRem < 21) {
      dropdown_menue.classList.add("dropdown_menue_Open_top");
      dropdown_menue.classList.remove("dropdown_menue_Open_bottom");
    } else {
      dropdown_menue.classList.add("dropdown_menue_Open_bottom");
      dropdown_menue.classList.remove("dropdown_menue_Open_top");
    }

    window.addEventListener('scroll', measureDistanceToBottom);
    window.addEventListener('resize', measureDistanceToBottom);
  }
}
   



    // استخدام الدالة
    createDropdown('/getEmployeesData1', 'employees_table', [
      { key: 'id', header: 'ID', style: 'display: none;' },
      { key: 'employee_name', header: 'Name', style: 'width: 100%;' }
    ], ['id', 'employee_name']);
    
    </script>
</body>

</html>